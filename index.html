<button id="coffee">Buy me a coffee (K1)</button>

<div id="status"></div>

<script>
const button = document.getElementById("coffee");
const statusDiv = document.getElementById("status");

button.addEventListener("click", async () => {
  statusDiv.textContent = "Processing payment...";

  try {
    // ✅ Make sure method is POST
    const res = await fetch("/api/create-payment", { method: "POST" });

    // ✅ Parse JSON only after POST succeeds
    const data = await res.json();

    console.log("Payment response:", data);

    if (data.lipila && data.lipila.status === "Pending") {
      statusDiv.innerHTML = `
        Payment request created! <br>
        Reference ID: ${data.referenceId} <br>
        <a href="${data.lipila.cardRedirectionUrl || '#'}" target="_blank">Complete Payment</a>
      `;
    } else {
      statusDiv.textContent = "Failed to create payment. Check console for details.";
    }

  } catch (err) {
    console.error(err);
    statusDiv.textContent = "Error creating payment. Check console.";
  }
});
</script>
